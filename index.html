<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Culture Snapshot Scorecard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Embed CSS directly in HTML for now -->
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }

        :root {
            --primary-color: #5B5FC7;
            --background-color: #f5f5f5;
            --primary-color-light: rgba(91, 95, 199, 0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        @media (max-width: 768px) {
            body {
                background-color: var(--background-color);
                padding: 0;
                margin: 0;
                width: 100%;
                box-sizing: border-box;
            }
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding-bottom: 3rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
                margin: 0;
                width: 100%;
                box-sizing: border-box;
                border-radius: 0;
                box-shadow: none;
                padding-bottom: 2rem;
            }

            .results-container {
                padding: 0;
                margin: 0;
                width: 100%;
                box-sizing: border-box;
            }

            .score-message,
            .cta-section,
            .score-section,
            .recommendations,
            .share-section {
                padding: 0.75rem;
                margin-left: 0;
                margin-right: 0;
                width: 100%;
                box-sizing: border-box;
            }
        }

        .personal-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-bottom: 2.5rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group input {
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Inter', sans-serif;
            width: 100%;
            box-sizing: border-box;
            font-size: 16px;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(91, 95, 199, 0.1);
        }

        .assessment-grid {
            margin-top: 1.5rem;
        }

        .scale-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding: 0;
            color: var(--primary-color);
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .question-group {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .question-item {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            padding: 1rem;
            background-color: #f8f8f8;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .question-item.unanswered {
            border: 2px solid #ED5C5C;
            background-color: rgba(237, 92, 92, 0.05);
        }

        .question-text {
            font-size: 14px;
            line-height: 1.4;
            color: #333;
            font-family: 'Inter', sans-serif;
        }

        .rating-scale {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 2px;
            margin-top: 0.5rem;
        }

        .rating-button {
            width: 100%;
            aspect-ratio: 1;
            padding: 2px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 4px;
            font-size: 12px;
            transition: all 0.2s ease-in-out;
            position: relative;
            font-family: 'Inter', sans-serif;
            transform: none;
        }

        .rating-button:hover {
            background-color: var(--primary-color-light);
            border-color: var(--primary-color);
            transform: none;
            box-shadow: none;
        }

        .rating-button.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: scale(1);
            box-shadow: 0 2px 4px rgba(91, 95, 199, 0.3);
        }

        .rating-button:active {
            transform: scale(0.95);
        }

        button[type="submit"] {
            margin-top: 2rem;
            margin-bottom: 2rem;
            padding: 1rem 2rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            transition: opacity 0.2s ease;
        }

        button[type="submit"]:hover {
            opacity: 0.9;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
            padding-top: 40px;
        }

        header h1 {
            color: #000000;
            font-size: 2rem;
            margin: 0 0 1rem 0;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
        }

        .logo {
            max-width: 250px;
            height: auto;
            margin: 1rem 0 2rem 0;
        }

        .form-group label {
            font-weight: 500;
            color: #333;
            font-family: 'Inter', sans-serif;
        }

        @media (max-width: 768px) {
            .personal-info {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 1rem;
            }
            
            .question-text {
                font-size: 13px;
            }

            header h1 {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
            }

            .logo {
                max-width: 180px;
                margin: 0.5rem 0 1rem 0;
            }

            .instruction-text {
                font-size: 13px;
                margin: 1rem 0;
            }

            .cta-section h3 {
                font-size: 1.2rem;
            }

            .cta-section p {
                font-size: 0.9rem;
            }

            .score-message h3 {
                font-size: 1.1rem;
            }

            .score-message p {
                font-size: 0.9rem;
            }

            .recommendations h3 {
                font-size: 1.2rem;
            }

            .recommendations p,
            .recommendations li {
                font-size: 0.9rem;
            }
        }

        /* Add specific mobile adjustments for very small screens */
        @media (max-width: 320px) {
            .container {
                padding: 0.75rem;
            }

            header h1 {
                font-size: 1.25rem;
            }

            .logo {
                max-width: 150px;
            }

            rating-scale {
                gap: 1px;
            }
            
            .rating-button {
                padding: 1px;
                font-size: 11px;
                border-radius: 2px;
            }
            
            .question-item {
                padding: 0.75rem;
            }

            .form-group label {
                font-size: 0.9rem;
            }

            .form-group input {
                padding: 0.5rem;
                font-size: 0.9rem;
            }

            button[type="submit"] {
                padding: 0.75rem 1.5rem;
                font-size: 0.9rem;
            }

            .score-section {
                padding: 0.75rem;
            }

            .score-header h4 {
                font-size: 0.9rem;
            }

            .score-value {
                font-size: 0.9rem;
            }

            .score-description {
                font-size: 0.8rem;
            }

            .gauge {
                width: 150px;
                height: 150px;
            }

            #engagementText {
                font-size: 24px !important;
            }

            .cta-section {
                padding: 1rem;
            }

            .cta-section h3 {
                font-size: 1rem;
            }

            .cta-section p {
                font-size: 0.85rem;
            }

            .cta-button {
                padding: 0.75rem 1.25rem;
                font-size: 0.9rem;
            }

            .popup-content {
                padding: 1rem;
            }

            .popup-option {
                padding: 0.75rem;
                font-size: 0.9rem;
            }

            .close-button {
                width: 32px;
                height: 32px;
                font-size: 20px;
                top: 10px;
                right: 10px;
            }
        }

        .score-summary {
            display: none;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
        }

        .average-score {
            text-align: center;
        }

        .score-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--primary-color);
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: 600;
            color: white;
        }

        /* Add style for the instruction text */
        .instruction-text {
            font-size: 16px;
            color: #333;
            margin: 3rem 0 2rem 0;
            padding: 0;
            font-weight: 500;
            text-align: left;
            font-family: 'Inter', sans-serif;
            line-height: 1.5;
        }

        /* Results Page Styles */
        .results-container {
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Clean 270-degree Gauge Styles */
        .gauge {
            margin: 2rem auto;
        }

        .gauge__background {
            stroke: #E5E7EB;
            stroke-linecap: round;
            fill: none;
        }

        .gauge__fill {
            stroke-linecap: round;
            fill: none;
            transition: stroke-dasharray 1s ease-in-out;
        }

        /* Add status text below percentage */
        .status {
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Inter', sans-serif;
            font-size: 1.5rem;
            color: #64748B; /* Grey color for status */
            margin: 0;
        }

        /* Container styling */
        .overall-score {
            text-align: center;
            margin: 1rem 0;
        }

        .overall-score h3 {
            margin-top: 2rem;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 1.5rem;
            color: #333;
        }

        /* Pill Gauges */
        .score-pill {
            margin: 1rem 0;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .question-label {
            width: 120px;
            font-weight: 500;
        }

        .pill-gauge {
            height: 12px;
            background: #f0f0f0;
            border-radius: 6px;
            overflow: hidden;
            margin: 0.75rem 0;
            position: relative;
        }

        .pill-gauge::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: calc(var(--percentage) * 1%);
            background: var(--color);
            border-radius: 6px;
            transition: width 1s ease-in-out;
        }

        .pill-value {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #333;
            font-weight: 500;
            z-index: 1;
        }

        /* Updated styles for individual scores */
        .individual-scores {
            margin-top: 3rem;
        }

        .score-section {
            margin-bottom: 2rem;
            padding: 1rem;
            background: #fff;
            border-radius: 8px;
        }

        .score-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .score-header h4 {
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 1.1rem;
            color: #333;
            margin: 0;
        }

        .score-value {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            color: #333;
        }

        .pill-gauge {
            height: 12px;
            background: #f0f0f0;
            border-radius: 6px;
            overflow: hidden;
            margin: 0.75rem 0;
            position: relative;
        }

        .pill-gauge::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: calc(var(--percentage) * 1%);
            background: var(--color);
            border-radius: 6px;
            transition: width 1s ease-in-out;
        }

        .score-description {
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            line-height: 1.5;
            color: #666;
            margin: 0.75rem 0 0 0;
        }

        .return-button {
            display: block;
            margin: 2rem auto;
            padding: 1rem 2rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            transition: opacity 0.2s ease;
        }

        .return-button:hover {
            opacity: 0.9;
        }

        .results-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }

        .percentage {
            font-family: 'Inter', sans-serif;
            font-size: 3rem;
            font-weight: 700;
            color: #333;
            text-align: center;
            margin: 2rem 0;
        }

        .cta-section {
            background: var(--primary-color-light);
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
            margin: 2rem 0;
        }

        .cta-section h3 {
            color: var(--primary-color);
            font-size: 1.5rem;
            margin-bottom: 1rem;
            font-weight: 500;
            font-family: 'Inter', sans-serif;
        }

        .cta-section p {
            color: #333;
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            line-height: 1.5;
        }

        .cta-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            border-radius: 4px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(91, 95, 199, 0.2);
        }

        .score-message {
            text-align: left;
            max-width: 600px;
            margin: 2rem auto;
            padding: 1.5rem;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            width: 100%;
            box-sizing: border-box;
        }

        .score-message h3 {
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .score-message p {
            line-height: 1.6;
            color: #333;
            margin: 0;
        }

        /* Add specific mobile adjustments */
        @media (max-width: 320px) {
            .rating-scale {
                gap: 1px;
            }
            
            .rating-button {
                padding: 1px;
                font-size: 11px;
                border-radius: 2px;
            }
            
            .question-item {
                padding: 0.75rem;
            }
        }

        .recommendations {
            margin: 3rem auto;
            padding: 2.5rem;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-width: 600px;
        }

        .recommendations h3 {
            color: #173248;
            margin-bottom: 1.25rem;
            font-weight: 600;
            font-size: 1.5rem;
        }

        .recommendations p {
            color: #333;
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        .recommendations ul {
            list-style: none;
            padding: 0;
            margin: 0 0 2rem 0;
        }

        .recommendations li {
            margin-bottom: 1.25rem;
            padding-left: 1.75rem;
            position: relative;
            line-height: 1.5;
        }

        .recommendations li:before {
            content: "→";  /* Changed to arrow for more strategic feel */
            color: var(--primary-color);
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        .recommendations li strong {
            color: var(--primary-color);
            font-weight: 600;
            display: block;  /* Put each header on its own line */
            margin-bottom: 0.25rem;
        }

        .recommendation-footer {
            font-weight: 500;
            color: #173248;
            text-align: center;
            margin: 2rem 0 1rem 0;
        }

        @media (max-width: 768px) {
            .recommendations {
                padding: 1.5rem;
                margin: 2rem auto;
            }
            
            .recommendations h3 {
                font-size: 1.25rem;
            }
        }

        .close-button {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: none;
            background: white;
            color: #666;
            font-size: 28px;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .close-button:hover {
            background: #f5f5f5;
            color: #333;
        }

        .results-container {
            position: relative;
        }

        .options-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: flex-start;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
            padding-top: 5vh;
        }

        .options-popup.active {
            display: flex;
            opacity: 1;
        }

        .popup-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            position: relative;
            width: 90%;
            max-width: 400px;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .popup-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .popup-option {
            padding: 1rem;
            background: #f8f8f8;
            border-radius: 4px;
            text-decoration: none;
            color: #333;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .popup-option:hover {
            background: var(--primary-color);
            color: white;
        }

        .popup-close {
            margin-top: 1.5rem;
            padding: 0.75rem 2rem;
            border: none;
            background: none;
            color: #666;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .popup-close:hover {
            color: #333;
        }

        @media (max-width: 768px) {
            .popup-content {
                width: 95%;
                padding: 1.5rem;
            }
        }

        /* Small mobile optimization */
        @media (max-width: 320px) {
            .options-popup {
                padding-top: 2vh;
            }
        }

        .question-number {
            font-weight: 600;
            color: var(--primary-color);
            margin-right: 0.5rem;
        }

        /* Mobile optimization for question numbers */
        @media (max-width: 320px) {
            .question-number {
                display: inline-block;
                margin-bottom: 0.25rem;
            }
        }

        .share-section {
            text-align: center;
            margin: 2rem 0;
        }

        .share-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background-color: white;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .share-button:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        .share-button svg {
            transition: transform 0.2s ease;
        }

        .share-button:hover svg {
            transform: translateY(-2px);
        }

        /* Mobile optimization */
        @media (max-width: 768px) {
            .share-button {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
        }

        .share-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .share-popup.active {
            opacity: 1;
        }

        .share-popup-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            position: relative;
            width: 90%;
            max-width: 400px;
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .share-popup.active .share-popup-content {
            transform: translateY(0);
        }

        .share-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .share-options button {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .share-options button:hover {
            background: var(--primary-color-light);
            border-color: var(--primary-color);
        }

        .copy-success {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #4CAF50;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, 20px); }
            15% { opacity: 1; transform: translate(-50%, 0); }
            85% { opacity: 1; transform: translate(-50%, 0); }
            100% { opacity: 0; transform: translate(-50%, -20px); }
        }

        @media (max-width: 768px) {
            .share-popup-content {
                padding: 1.5rem;
            }
            
            .share-options {
                gap: 0.75rem;
            }
            
            .share-options button {
                padding: 0.75rem;
                font-size: 0.9rem;
            }
        }

        .share-section.bottom {
            background: #fff;
            padding: 2rem;
            border-radius: 8px;
            margin-top: 2rem;
            text-align: center;
            border: 1px solid var(--primary-color-light);
        }

        .share-section.bottom p {
            color: #666;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        /* Mobile optimization */
        @media (max-width: 768px) {
            .share-section.bottom {
                padding: 1.5rem;
                margin-top: 1.5rem;
            }
            
            .share-section.bottom p {
                font-size: 0.9rem;
            }
        }

        .form-group.unanswered input {
            border-color: #ED5C5C;
            background-color: rgba(237, 92, 92, 0.05);
        }

        .form-group.unanswered label {
            color: #ED5C5C;
        }

        /* Remove red highlighting when user starts filling in the field */
        .form-group.unanswered input:focus {
            border-color: var(--primary-color);
            background-color: white;
        }

        .form-group input:focus + label {
            color: var(--primary-color);
        }

        /* Add real-time validation feedback */
        .form-group input:valid {
            border-color: #5EBD77;
        }

        /* Prevent scroll bounce on iOS */
        html {
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        /* Update the results page styles for mobile */
        @media (max-width: 768px) {
            .container {
                padding: 0.75rem;
                margin: 0;
                box-shadow: none;
                border-radius: 0;
            }

            .results-container {
                padding: 0;
                margin: 0;
            }

            /* Header adjustments */
            header {
                margin-bottom: 1rem;
                padding-top: 30px;
            }

            header h1 {
                font-size: 1.25rem;
                padding: 0 25px; /* Make room for close button */
            }

            .close-button {
                top: 0;
                right: 0;
                width: 30px;
                height: 30px;
                font-size: 18px;
                padding: 0;
            }

            /* Gauge adjustments */
            .gauge {
                width: 140px;
                height: 140px;
                margin: 1.5rem auto;
            }

            #engagementText {
                font-size: 24px !important;
            }

            /* Score message adjustments */
            .score-message {
                margin: 1.5rem 0;
                padding: 1rem;
                width: 100%;
                box-sizing: border-box;
            }

            .score-message h3 {
                font-size: 1.1rem;
                margin-bottom: 0.75rem;
                text-align: left;
            }

            .score-message p {
                font-size: 0.9rem;
                line-height: 1.5;
                text-align: left;
                margin: 0;
            }

            /* CTA section adjustments */
            .cta-section {
                margin: 1rem 0;
                padding: 1rem;
            }

            .cta-section h3 {
                font-size: 1.1rem;
                margin-bottom: 0.5rem;
            }

            .cta-section p {
                font-size: 0.9rem;
                margin-bottom: 1rem;
            }

            .cta-button {
                padding: 0.75rem 1.5rem;
                font-size: 0.9rem;
            }

            /* Individual scores adjustments */
            .individual-scores {
                margin-top: 1.5rem;
            }

            .individual-scores h3 {
                font-size: 1.1rem;
                margin-bottom: 1rem;
            }

            .score-section {
                margin-bottom: 1rem;
                padding: 1rem;
                background: #f8f8f8;
                border-radius: 6px;
            }

            .score-header h4 {
                font-size: 0.9rem;
            }

            .score-value {
                font-size: 0.9rem;
            }

            .score-description {
                font-size: 0.85rem;
                line-height: 1.4;
                margin-top: 0.5rem;
            }

            /* Share section adjustments */
            .share-section.bottom {
                margin: 1rem 0;
                padding: 1rem;
            }

            .share-section.bottom p {
                font-size: 0.9rem;
                margin-bottom: 0.75rem;
            }

            .share-button {
                padding: 0.75rem 1.25rem;
                font-size: 0.9rem;
            }
        }

        /* Additional optimization for very narrow screens */
        @media (max-width: 320px) {
            .container {
                padding: 0.25rem;
            }

            .gauge {
                width: 120px;
                height: 120px;
            }

            .score-section,
            .score-message,
            .cta-section {
                padding: 0.5rem;
            }
        }

        /* Update gauge and score message spacing */
        .overall-score {
            text-align: center;
            margin: 1rem 0;  /* Reduced top/bottom margin */
        }

        .gauge {
            position: relative;
            width: 195px;  /* Match SVG viewBox width */
            height: 195px; /* Match SVG viewBox height */
            margin: 2rem auto;  /* Center horizontally with auto margins */
            display: block;  /* Ensure block-level display */
        }

        .gauge svg {
            width: 100%;
            height: 100%;
            display: block;  /* Remove any inline spacing */
            margin: 0 auto;  /* Center the SVG */
        }

        /* Update the results container styles */
        .results-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            text-align: center;  /* Center all content */
        }

        /* Ensure the overall score container is centered */
        .overall-score {
            margin: 0 auto;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .score-message {
            text-align: left;
            max-width: 600px;
            margin: 2rem auto;  /* Increased top/bottom margin */
            padding: 1.5rem;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            width: 100%;
            box-sizing: border-box;
        }

        /* Mobile adjustments */
        @media (max-width: 768px) {
            .gauge {
                width: 140px;
                height: 140px;
                margin: 1.5rem auto 1.5rem auto;  /* Adjusted for mobile */
            }

            .score-message {
                margin: 1.5rem 0;
                padding: 1rem;
                width: 100%;
                box-sizing: border-box;
            }

            .score-message h3 {
                font-size: 1.1rem;
                margin-bottom: 0.75rem;
                text-align: left;  /* Ensure header is left-aligned */
            }

            .score-message p {
                font-size: 0.9rem;
                line-height: 1.5;
                text-align: left;  /* Ensure text is left-aligned */
                margin: 0;
            }
        }

        /* Very narrow screen optimization */
        @media (max-width: 320px) {
            .gauge {
                margin: 0.75rem auto 1rem auto;  /* Further reduced margins */
            }

            .score-message {
                margin: 1rem 0;
                padding: 0.75rem;
            }
        }

        .intro-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }

        .intro-text {
            text-align: left;
            line-height: 1.6;
        }

        .intro-text h2, .intro-text h3 {
            color: var(--primary-color);
            margin: 2rem 0 1rem;
        }

        .contact-info {
            background: var(--primary-color-light);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
        }

        .contact-info p {
            margin: 0.5rem 0;
        }

        .begin-button {
            display: block;
            width: 100%;
            max-width: 300px;
            margin: 3rem auto;
            padding: 1rem 2rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            font-size: 1.1rem;
            transition: all 0.2s ease;
        }

        .begin-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(91, 95, 199, 0.2);
        }

        @media (max-width: 768px) {
            .intro-content {
                padding: 1rem;
            }
            
            .contact-info {
                padding: 1rem;
            }
        }

        .error-message {
            color: #ED5C5C;
            background-color: rgba(237, 92, 92, 0.1);
            padding: 12px;
            border-radius: 4px;
            margin: 1rem auto;
            max-width: 600px;
            text-align: center;
            font-size: 14px;
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .open-questions {
            margin-bottom: 4rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 2rem;
        }

        .question-block {
            margin-bottom: 2rem;
        }

        .question-block h3 {
            font-size: 16px;
            color: #333;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .question-block h3::after {
            content: "";
        }

        .question-block.unanswered {
            border: 2px solid #ED5C5C;
            background-color: rgba(237, 92, 92, 0.05);
            padding: 1rem;
            border-radius: 4px;
        }

        .question-block.unanswered input:first-child {
            border-color: #ED5C5C;
            background-color: rgba(237, 92, 92, 0.05);
        }

        .question-block.unanswered h3 {
            color: #ED5C5C;
        }

        /* Update existing question-item styles for consistency */
        .question-item.unanswered {
            border: 2px solid #ED5C5C;
            background-color: rgba(237, 92, 92, 0.05);
        }

        .question-item.unanswered .question-text {
            color: #ED5C5C;
        }

        /* Remove error state when user starts typing */
        .question-block.unanswered input:focus {
            border-color: var(--primary-color);
            background-color: white;
        }

        .question-block input:focus + h3 {
            color: var(--primary-color);
        }

        /* Add real-time validation feedback */
        .question-block input:valid {
            border-color: #5EBD77;
        }

        .question-description {
            font-size: 16px;
            color: #666;
            margin-bottom: 1.5rem;
            line-height: 1.5;
            font-style: italic;
        }

        .input-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .input-list input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Inter', sans-serif;
            font-size: 16px;
        }

        .input-list input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(91, 95, 199, 0.1);
        }

        textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Inter', sans-serif;
            font-size: 16px;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(91, 95, 199, 0.1);
        }

        @media (max-width: 768px) {
            .question-block h3,
            .question-description,
            .input-list input,
            textarea {
                font-size: 14px;
            }

            .input-list {
                gap: 0.75rem;
            }

            .question-block {
                margin-bottom: 1.5rem;
            }
        }

        .thank-you-message {
            text-align: center;
            max-width: 600px;
            margin: 3rem auto;
            padding: 0 1rem;
        }

        .thank-you-message h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        .thank-you-message p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        /* Mobile optimization */
        @media (max-width: 768px) {
            .thank-you-message h2 {
                font-size: 1.25rem;
            }

            .thank-you-message p {
                font-size: 1rem;
            }

            .gauge {
                width: 140px;
                height: 140px;
                margin: 1.5rem auto;
            }
        }

        .question-block.unanswered textarea {
            border-color: #ED5C5C;
            background-color: rgba(237, 92, 92, 0.05);
        }

        .question-block textarea:valid {
            border-color: #5EBD77;
        }

        /* Remove the green validation styling for the open questions section */
        .question-block input:valid,
        .question-block textarea:valid {
            border-color: #ddd;  /* Reset to default border color */
        }

        /* Keep the red validation styling for errors */
        .question-block.unanswered input,
        .question-block.unanswered textarea {
            border-color: #ED5C5C;
            background-color: rgba(237, 92, 92, 0.05);
        }
    </style>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Introduction Section (initially visible) -->
        <div id="introSection">
            <header>
                <h1>Organizational Health Snapshot™</h1>
                <img src="https://static.showit.co/file/JNQ0xT5W_YRPIk_uSDJ7-Q/176740/3.png" alt="The Culture MRI Logo" class="logo">
            </header>

            <!-- Add the personal info form here -->
            <div class="personal-info">
                <div class="form-group">
                    <label for="name">Name*</label>
                    <input type="text" id="name" required minlength="2">
                </div>
                <div class="form-group">
                    <label for="company">Company*</label>
                    <input type="text" id="company" required minlength="2">
                </div>
                <div class="form-group">
                    <label for="email">Email*</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="role">Job Role*</label>
                    <input type="text" id="role" required minlength="2">
                </div>
            </div>

            <div class="intro-content">
                <div class="intro-text">
                    <h2>How to Complete this Evaluation</h2>
                    <p>Thank you for taking the time to complete this Culture Operations evaluation. You will gain valuable insights by learning how a systematic approach to culture can help to improve employee engagement and increase your overall profitability.</p>
                    
                    <h3>Your Culture Operations Scorecard</h3>
                    <p>You can't get this wrong. There is no one "right" answer. The clearer and more accurate you are, the better the outcome will be. Your feedback will provide the information to get a clear picture of where you are and where you want to be, while enabling you to better understand the reality of your current situation with regard to Culture Operations.</p>
                    
                    <h3>Your Vision</h3>
                    <p>Please complete the scorecard by indicating where you currently stand for each of the 10 statements listed. Score from 1 to 10 for each in relation to your current reality (1 being the weakest and 10 being the strongest).</p>
                    
                    <p>To protect the integrity of the results, please wait to discuss or share your answers with others. Answer the first question as if you knew you could NOT fail. Consider what's possible, what's not possible, and, most importantly, what you would consider success.</p>
                    
                    <p>Answer "what's preventing you from getting there" with as little opinion as possible. Think "just the facts". Please answer each question as fully as possible. Take your time. This is the opportunity for you to think about your culture more fully.</p>
                    
                    <h3>Here to Support You</h3>
                    <p>Should you need assistance or have questions, feel free to reach out anytime:</p>
                    <div class="contact-info">
                        <p>Bob Keator, The Culture MRI</p>
                        <p>Phone: (404) 695-3712</p>
                        <p>Email: bob@theculturemri.com</p>
                        <p>Schedule: <a href="https://calendly.com/culturemri" target="_blank">calendly.com/culturemri</a></p>
                        <p>Website: <a href="https://www.TheCultureMRI.com" target="_blank">www.TheCultureMRI.com</a></p>
                    </div>
                </div>
                
                <button onclick="showQuestionnaire()" class="begin-button">Begin Evaluation</button>
            </div>
        </div>

        <!-- Questionnaire Section (initially hidden) -->
        <div id="questionnaireSection" style="display: none;">
            <form id="cultureForm">
                <!-- New Questions Section -->
                <div class="open-questions">
                    <div class="question-block">
                        <h3>1. What does success look like? *</h3>
                        <p class="question-description">Imagine we've assessed employee engagement at your company and your Culture Operations plan has been in place for a year. You and your entire team are remarking how great the culture is. What progress, metrics, programs, or outcomes would you point to that would cause you to feel this way?</p>
                        <div class="input-list">
                            <input type="text" placeholder="1.*" required>
                            <input type="text" placeholder="2.">
                            <input type="text" placeholder="3.">
                        </div>
                        <textarea placeholder="Additional Comments:" rows="3"></textarea>
                    </div>

                    <div class="question-block">
                        <h3>2. What's currently preventing you from getting there? *</h3>
                        <div class="input-list">
                            <input type="text" placeholder="1.*" required>
                            <input type="text" placeholder="2.">
                            <input type="text" placeholder="3.">
                        </div>
                        <textarea placeholder="Additional Comments:" rows="3"></textarea>
                    </div>

                    <div class="question-block">
                        <h3>3. Is there anything else you would like to share? *</h3>
                        <textarea rows="4" required placeholder="*Please Share"></textarea>
                    </div>
                </div>

                <!-- Original Rating Questions -->
                <div class="instruction-text">
                    Indicate the degree to which you agree or disagree with these statements:
                </div>

                <div class="assessment-grid">
                    <div class="scale-header">
                        <span>DISAGREE</span>
                        <span>AGREE</span>
                    </div>
                    
                    <div class="question-group">
                        <!-- Questions will be added via JavaScript -->
                    </div>
                </div>

                <button type="submit">See My Results</button>
            </form>

            <div class="score-summary" style="display: none;">
                <h2>Assessment Summary</h2>
                <div class="summary-grid">
                    <div class="average-score">
                        <h3>Average Score</h3>
                        <div class="score-circle"></div>
                    </div>
                    <div class="score-breakdown">
                        <h3>Breakdown by Category</h3>
                        <!-- Dynamic content -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Add this before your existing JavaScript code
        const questions = [
            "We have a clear and compelling vision that inspires our team.",
            "Our leadership team effectively communicates and models our values.",
            "We have well-defined processes for recruiting and retaining top talent.",
            "Our onboarding process effectively integrates new hires into our culture.",
            "We regularly measure and act on employee feedback and engagement.",
            "Our performance management system aligns with our cultural values.",
            "We invest in ongoing professional development and growth opportunities.",
            "Our workplace environment promotes collaboration and innovation.",
            "We have effective systems for recognition and rewards.",
            "Our culture directly contributes to our business success."
        ];

        function createQuestionElement(questionText, index) {
            const questionItem = document.createElement('div');
            questionItem.className = 'question-item';
            questionItem.innerHTML = `
                <div class="question-text">
                    <span class="question-number">${index + 1}.</span> ${questionText}
                </div>
                <div class="rating-scale">
                    ${Array.from({length: 10}, (_, i) => `
                        <button type="button" 
                                class="rating-button" 
                                data-value="${i + 1}" 
                                data-question="${index + 1}">
                            ${i + 1}
                        </button>
                    `).join('')}
                </div>
            `;

            // Add click handlers for rating buttons
            const ratingButtons = questionItem.querySelectorAll('.rating-button');
            ratingButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    // Remove selected class from all buttons in this question
                    ratingButtons.forEach(btn => btn.classList.remove('selected'));
                    // Add selected class to clicked button
                    this.classList.add('selected');
                    // Remove unanswered class if present
                    questionItem.classList.remove('unanswered');
                });
            });

            return questionItem;
        }

        // Make sure this is at the top level of your JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize form with questions
            const questionGroup = document.querySelector('.question-group');
            if (questionGroup) {
                questions.forEach((question, index) => {
                    const questionElement = createQuestionElement(question, index);
                    questionGroup.appendChild(questionElement);
                });
            }

            // Store original questionnaire HTML
            originalFormHTML = document.getElementById('questionnaireSection').innerHTML;
            
            // Add click handler for Begin Evaluation button
            const beginButton = document.querySelector('.begin-button');
            if (beginButton) {
                beginButton.addEventListener('click', showQuestionnaire);
            }

            // Add submit handler for the form
            const form = document.getElementById('cultureForm');
            if (form) {
                form.addEventListener('submit', handleFormSubmit);
            }
        });

        // Add this at the top of your JavaScript to store form data
        let formData = {
            name: '',
            company: '',
            email: '',
            role: ''
        };

        function showQuestionnaire() {
            // Get all required fields
            formData = {
                name: document.getElementById('name').value.trim(),
                company: document.getElementById('company').value.trim(),
                email: document.getElementById('email').value.trim(),
                role: document.getElementById('role').value.trim()
            };

            // Remove any existing error states
            document.querySelectorAll('.form-group').forEach(group => {
                group.classList.remove('unanswered');
            });

            // Check if all required fields are filled
            let isValid = true;
            Object.entries(formData).forEach(([key, value]) => {
                if (!value) {
                    isValid = false;
                    const field = document.getElementById(key);
                    field.parentElement.classList.add('unanswered');
                }
            });

            // Additional email validation
            if (formData.email && !isValidEmail(formData.email)) {
                isValid = false;
                document.getElementById('email').parentElement.classList.add('unanswered');
            }

            if (!isValid) {
                // Scroll to first empty field
                const firstEmptyField = document.querySelector('.unanswered');
                if (firstEmptyField) {
                    firstEmptyField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                
                // Show error message
                showErrorMessage('Please fill in all required fields correctly.');
                return;
            }

            // Show questionnaire section first
            document.getElementById('introSection').style.display = 'none';
            document.getElementById('questionnaireSection').style.display = 'block';
            
            // Force scroll to the absolute top immediately
            window.scrollTo({
                top: 0,
                left: 0,
                behavior: 'instant'
            });

            // Add a small delay to ensure the scroll happens after the content switch
            setTimeout(() => {
                window.scrollTo({
                    top: 0,
                    left: 0,
                    behavior: 'instant'
                });
            }, 0);
        }

        // Update submitToGoogleSheet function
        function submitToGoogleSheet(data) {
            const scriptUrl = 'YOUR_SCRIPT_URL_HERE';
            
            // Get all the open questions data
            const q1Inputs = Array.from(document.querySelector('.question-block:nth-child(1)').querySelectorAll('input')).map(input => input.value.trim());
            const q2Inputs = Array.from(document.querySelector('.question-block:nth-child(2)').querySelectorAll('input')).map(input => input.value.trim());
            const q1Comments = document.querySelector('.question-block:nth-child(1) textarea').value.trim();
            const q2Comments = document.querySelector('.question-block:nth-child(2) textarea').value.trim();
            const q3Response = document.querySelector('.question-block:nth-child(3) textarea').value.trim();

            // Get all rating questions
            const ratingScores = Array.from(document.querySelectorAll('.question-item')).map(item => {
                const selectedButton = item.querySelector('.rating-button.selected');
                return selectedButton ? parseInt(selectedButton.dataset.value) : '';
            });

            const formattedData = {
                name: data.name,
                company: data.company,
                email: data.email,
                role: data.role,
                
                // Q1 responses (What does success look like?)
                'Q1: 1': q1Inputs[0],
                'Q1: 2': q1Inputs[1],
                'Q1: 3': q1Inputs[2],
                'Q1: Comments': q1Comments,
                
                // Q2 responses (What's currently preventing you?)
                'Q2: 1': q2Inputs[0],
                'Q2: 2': q2Inputs[1],
                'Q2: 3': q2Inputs[2],
                'Q2: Comments': q2Comments,
                
                // Q3 response
                'Q3': q3Response,
                
                // Rating questions
                'Rating Q1': ratingScores[0],
                'Rating Q2': ratingScores[1],
                'Rating Q3': ratingScores[2],
                'Rating Q4': ratingScores[3],
                'Rating Q5': ratingScores[4],
                'Rating Q6': ratingScores[5],
                'Rating Q7': ratingScores[6],
                'Rating Q8': ratingScores[7],
                'Rating Q9': ratingScores[8],
                'Rating Q10': ratingScores[9],
                
                'Average Score': data.averageScore,
                'Source': window.location.href,
                'Referrer': document.referrer || 'CMRI'
            };
            
            console.log('Submitting data:', formattedData); // Debug log
            
            fetch(scriptUrl, {
                method: 'POST',
                body: JSON.stringify(formattedData)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }

        // Add these helper functions
        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function showErrorMessage(message) {
            // Remove any existing error message
            const existingError = document.querySelector('.error-message');
            if (existingError) {
                existingError.remove();
            }

            // Create and show new error message
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            
            // Insert after the form
            const personalInfo = document.querySelector('.personal-info');
            personalInfo.insertAdjacentElement('afterend', errorDiv);

            // Auto-remove after 5 seconds
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        function getStatus(percentage) {
            if (percentage <= 50) return 'Poor';
            if (percentage <= 84) return 'Fair';
            return 'Good';
        }

        function getScoreMessage(percentage) {
            if (percentage <= 50) {
                return `
                    <h3 style="color: #ED5C5C; margin-bottom: 1rem;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ED5C5C" stroke-width="2" style="margin-right: 8px; vertical-align: -4px;">
                            <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                        </svg>
                        Critical Condition
                    </h3>
                    <p style="line-height: 1.6; color: #333;">
                        Your Organizational Health Snapshot™ indicates urgent challenges requiring immediate attention. 
                        Low scores suggest unmet employee needs, misalignment, and significant risks to productivity 
                        and profitability. Addressing these issues quickly can stabilize operations, reengage your 
                        workforce, and recover lost potential. Act now to begin transforming your organizational 
                        health into a competitive advantage.
                    </p>
                `;
            } else if (percentage <= 84) {
                return `
                    <h3 style="color: #DFD691; margin-bottom: 1rem;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#DFD691" stroke-width="2" style="margin-right: 8px; vertical-align: -4px;">
                            <path d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Active Risks 
                    </h3>
                    <p style="line-height: 1.6; color: #333;">
                        Your Organizational Health Snapshot™ reveals areas of concern that require proactive intervention. 
                        While some systems are stable, gaps in meeting employee needs and optimizing performance place 
                        your organization at risk of declining productivity and profitability. Timely action to address 
                        these vulnerabilities can create a path toward stronger alignment, engagement, and growth.
                    </p>
                `;
            } else {
                return `
                    <h3 style="color: #5EBD77; margin-bottom: 1rem;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#5EBD77" stroke-width="2" style="margin-right: 8px; vertical-align: -4px;">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Steady State
                    </h3>
                    <p style="line-height: 1.6; color: #333;">
                        Your Organizational Health Snapshot™ indicates a strong foundation with many systems functioning well. 
                        However, even high-performing organizations can uncover opportunities to elevate outcomes further. 
                        Refining overlooked areas or addressing emerging challenges can help sustain and enhance your team's 
                        engagement, productivity, and profitability. Keep striving to transform strong performance into 
                        exceptional results.
                    </p>
                `;
            }
        }

        // Add these JavaScript functions:
        function showOptionsPopup() {
            const popup = document.getElementById('optionsPopup');
            popup.style.display = 'flex';
            popup.style.opacity = '1';
            window.history.pushState({ showPopup: true }, '');
        }

        function hideOptionsPopup() {
            const popup = document.getElementById('optionsPopup');
            popup.style.opacity = '0';
            setTimeout(() => {
                popup.style.display = 'none';
            }, 300);
            window.history.back();
        }

        // Add popstate event listener after the existing event listeners
        window.addEventListener('popstate', function(event) {
            if (event.state && event.state.showPopup) {
                showOptionsPopup();
            } else {
                const popup = document.getElementById('optionsPopup');
                if (popup) {
                    popup.style.opacity = '0';
                    setTimeout(() => {
                        popup.style.display = 'none';
                    }, 300);
                }
            }
        });

        function createShareButton() {
            return `
                <div class="share-section bottom">
                    <p>Save your snapshot summary to share with your team:</p>
                    <button onclick="downloadScreenshot()" class="share-button">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                            <polyline points="16 6 12 2 8 6"></polyline>
                            <line x1="12" y1="2" x2="12" y2="15"></line>
                        </svg>
                        Save Summary
                    </button>
                </div>
            `;
        }

        async function downloadScreenshot() {
            try {
                // Show loading state
                const button = document.querySelector('.share-button');
                const originalText = button.innerHTML;
                button.disabled = true;
                button.innerHTML = 'Creating snapshot...';

                // Create a temporary container
                const tempContainer = document.createElement('div');
                tempContainer.style.cssText = `
                    background: white;
                    padding: 40px;
                    width: 600px;
                    text-align: center;
                    font-family: 'Inter', sans-serif;
                `;

                // Get the score value
                const scoreText = document.getElementById('engagementText').textContent;
                
                // Get the score message content
                const scoreMessage = document.querySelector('.score-message').cloneNode(true);
                
                // Get the first CTA section
                const cta = document.querySelector('.cta-section').cloneNode(true);

                // Build simplified HTML without external images
                tempContainer.innerHTML = `
                    <div style="margin: 0 auto; max-width: 500px;">
                        <h2 style="color: #333; margin-bottom: 30px; font-size: 24px;">
                            Organizational Health Snapshot
                        </h2>
                        
                        <div style="margin: 40px auto; font-size: 48px; font-weight: bold; color: ${getScoreColor(parseInt(scoreText))}>
                            ${scoreText}
                        </div>
                        
                        <div style="margin: 30px auto;">
                            ${scoreMessage.innerHTML}
                        </div>
                        
                        <div style="margin-top: 30px;">
                            ${cta.innerHTML}
                        </div>
                    </div>
                `;

                // Add to document temporarily
                tempContainer.style.position = 'absolute';
                tempContainer.style.left = '-9999px';
                document.body.appendChild(tempContainer);

                // Create canvas
                const canvas = await html2canvas(tempContainer, {
                    scale: 2,
                    logging: false,
                    backgroundColor: '#ffffff',
                    windowWidth: 600,
                    width: 600
                });

                // Remove temporary container
                document.body.removeChild(tempContainer);

                // Create and trigger download
                canvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.download = `Culture_Snapshot_${new Date().toISOString().split('T')[0]}.png`;
                    link.href = url;
                    link.click();
                    URL.revokeObjectURL(url);
                    
                    // Restore button state
                    button.disabled = false;
                    button.innerHTML = originalText;
                });

            } catch (error) {
                console.error('Screenshot error:', error);
                alert('Unable to save snapshot. Please try again or contact support.');
                
                // Restore button state
                button.disabled = false;
                button.innerHTML = originalText;
            }
        }

        // Helper function to get score color
        function getScoreColor(score) {
            if (score <= 50) return '#ED5C5C';
            if (score <= 84) return '#DFD691';
            return '#5EBD77';
        }

        // Update form submit handler
        function handleFormSubmit(e) {
            e.preventDefault();

            // Get stored form data
            const storedFormData = JSON.parse(localStorage.getItem('formData')) || formData;

            // Validate Questions #1, #2, and #3
            const openQuestions = document.querySelectorAll('.question-block');
            let isValid = true;
            let firstError = null;

            // Check first input of first two questions
            for (let i = 0; i < 2; i++) {
                const firstInput = openQuestions[i].querySelector('input');
                if (!firstInput.value.trim()) {
                    isValid = false;
                    openQuestions[i].classList.add('unanswered');
                    if (!firstError) firstError = openQuestions[i];
                } else {
                    openQuestions[i].classList.remove('unanswered');
                }
            }

            // Check question 3's textarea
            const question3Textarea = openQuestions[2].querySelector('textarea');
            if (!question3Textarea.value.trim()) {
                isValid = false;
                openQuestions[2].classList.add('unanswered');
                if (!firstError) firstError = openQuestions[2];
            } else {
                openQuestions[2].classList.remove('unanswered');
            }

            // Validate 1-10 rating questions
            const questionItems = document.querySelectorAll('.question-item');
            let totalScore = 0;
            let answeredQuestions = 0;
            
            questionItems.forEach(item => {
                const selectedButton = item.querySelector('.rating-button.selected');
                if (!selectedButton) {
                    isValid = false;
                    item.classList.add('unanswered');
                    if (!firstError) firstError = item;
                } else {
                    item.classList.remove('unanswered');
                    totalScore += parseInt(selectedButton.dataset.value);
                    answeredQuestions++;
                }
            });

            if (!isValid) {
                // Show error message
                showErrorMessage('Please complete all required fields and rate all questions before submitting.');
                
                // Scroll to first error
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                return;
            }

            // Calculate average score
            const averageScore = Math.round((totalScore / answeredQuestions) * 10);

            // Collect form data
            const submissionData = {
                ...storedFormData,  // Include the stored personal info
                openQuestions: {
                    success: Array.from(openQuestions[0].querySelectorAll('input')).map(input => input.value),
                    barriers: Array.from(openQuestions[1].querySelectorAll('input')).map(input => input.value),
                    additional: openQuestions[2].querySelector('textarea').value
                },
                scores: Array.from(questionItems).map(item => {
                    const selected = item.querySelector('.rating-button.selected');
                    return selected ? parseInt(selected.dataset.value) : 0;
                }),
                averageScore: averageScore
            };

            // Submit to Google Sheet if needed
            submitToGoogleSheet(submissionData);

            // Show results section
            showResults(submissionData);

            // Clear stored form data
            localStorage.removeItem('formData');
        }

        function showResults(formData) {
            const container = document.querySelector('.container');
            container.innerHTML = `
                <div class="results-container">
                    <div class="thank-you-message">
                        <h2>Thank You for Completing Your Assessment</h2>
                        <p>Your responses help us understand your organization's current culture operations and identify opportunities for improvement.</p>
                        <p>We look forward to helping you transform these insights into actionable strategies for your organization.</p>
                    </div>
                </div>
            `;

            // Submit to Google Sheet still happens in the background
            submitToGoogleSheet(formData);
        }
    </script>
</body>
</html>
